<html>
<head>
  <title>Simple Notes</title>
  <style>
    html {
      font-family: "Courier New", monospace;
      line-height: 1.5;
      padding: 20px;
      background-color: #f9f9f9;
    }
    
    body {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      min-height: 90vh;
      outline: none;
      white-space: pre-wrap;
    }
    
    #editor {
      width: 100%;
      min-height: 80vh;
      outline: none;
      white-space: pre-wrap;
    }
    
    pre {
      background-color: #f0f0f0;
      padding: 10px;
      border-radius: 3px;
      overflow-x: auto;
    }
    
    code {
      background-color: #f0f0f0;
      padding: 2px 4px;
      border-radius: 2px;
      font-family: "Courier New", monospace;
    }
    
    ul, ol {
      padding-left: 30px;
      list-style-type: none;
    }
    
    li {
      position: relative;
    }
    
    .toolbar {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      padding: 5px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      display: flex;
      gap: 5px;
      z-index: 100;
    }
    
    .toolbar button {
      background: none;
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 5px 8px;
      cursor: pointer;

      &:hover {
        background: #f0f0f0;
      }
      
      &:active {
        background: #e0e0e0;
      }
    }
    
    .toolbar select {
      background: none;
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 4px;
      cursor: pointer;
    }
    
    .word-count {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: white;
      padding: 5px 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      font-size: 14px;
      z-index: 100;
    }
    
    /* Theme styles */
    body.dark-theme {
      background-color: #2a2a2a;
      color: #e0e0e0;
      
      & pre, & code {
        background-color: #3a3a3a;
        color: #e0e0e0;
      }
    }
    
    html.dark-theme {
      background-color: #1a1a1a;
    }
    
    .dark-theme .toolbar,
    .dark-theme .word-count {
      background: #333;
      color: #e0e0e0;
    }
    
    .dark-theme .toolbar button,
    .dark-theme .toolbar select {
      border-color: #555;
      color: #e0e0e0;
      
      &:hover {
        background: #444;
      }
      
      &:active {
        background: #555;
      }
    }
    
    /* Highlight styling */
    .highlight-yellow {
      background-color: #ffeaa7;
    }
    
    .highlight-green {
      background-color: #b8e994;
    }
    
    .highlight-blue {
      background-color: #7ed6df;
    }
    
    .highlight-red {
      background-color: #ff7979;
    }
    
    .dark-theme .highlight-yellow {
      background-color: #8c7c36;
    }
    
    .dark-theme .highlight-green {
      background-color: #336534;
    }
    
    .dark-theme .highlight-blue {
      background-color: #2c5e63;
    }
    
    .dark-theme .highlight-red {
      background-color: #803232;
    }
  </style>
</head>
<body>
  <div id="editor" contenteditable="true" autofocus></div>
  
  <div class="toolbar">
    <button id="btn-bold" title="Bold (Ctrl+B)">B</button>
    <button id="btn-italic" title="Italic (Ctrl+I)">I</button>
    <button id="btn-code" title="Code Block (Ctrl+K)">Code</button>
    <button id="btn-list" title="List (Ctrl+L)">â€¢ List</button>
    <select id="highlight-select" title="Highlight">
      <option value="">Highlight</option>
      <option value="highlight-yellow">Yellow</option>
      <option value="highlight-green">Green</option>
      <option value="highlight-blue">Blue</option>
      <option value="highlight-red">Red</option>
      <option value="remove">Remove</option>
    </select>
    <button id="btn-theme" title="Toggle Dark/Light Theme">ðŸŒ“</button>
    <button id="btn-export" title="Export as Text">ðŸ“¤</button>
    <button id="btn-save" title="Save (Ctrl+S)">ðŸ’¾</button>
  </div>
  
  <div class="word-count">Words: 0 | Characters: 0</div>

  <script>
    const editor = document.getElementById('editor');
    
    // Load saved content
    const savedContent = localStorage.getItem("saved-content");
    if (savedContent) {
      editor.innerHTML = savedContent;
    }
    
    // Load theme preference
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") {
      document.documentElement.classList.add("dark-theme");
      document.body.classList.add("dark-theme");
    }
    
    // Auto-save every 2 seconds
    setInterval(() => {
      localStorage.setItem("saved-content", editor.innerHTML);
      updateWordCount();
    }, 2000);
    
    // Update word count
    function updateWordCount() {
      const text = editor.innerText || "";
      const wordCount = text.trim() === "" ? 0 : text.trim().split(/\s+/).length;
      const charCount = text.length;
      
      document.querySelector(".word-count").textContent = `Words: ${wordCount} | Characters: ${charCount}`;
    }
    
    // Initial word count
    updateWordCount();
    
    // Listen for content changes to update word count
    editor.addEventListener("input", updateWordCount);

    editor.addEventListener('keydown', function(e) {
      // Tab key - insert 4 spaces
      if (e.key === 'Tab') {
        e.preventDefault();
        insertSpaces(4);
        return;
      }
      
      // Backspace - handle tab removal
      if (e.key === 'Backspace') {
        if (handleBackspace()) {
          e.preventDefault();
        }
        return;
      }
      
      // Enter key - handle list continuation
      if (e.key === 'Enter') {
        if (handleEnter()) {
          e.preventDefault();
        }
        return;
      }
      
      // Keyboard shortcuts
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'b': // Bold
            e.preventDefault();
            document.execCommand('bold');
            break;
            
          case 'i': // Italic
            e.preventDefault();
            document.execCommand('italic');
            break;
            
          case 'k': // Code
            e.preventDefault();
            handleCodeBlock();
            break;
            
          case 'l': // List
            e.preventDefault();
            handleList();
            break;
            
          case 's': // Save
            e.preventDefault();
            //localStorage.setItem("saved-content", editor.innerHTML);
            showNotification("Content saved successfully");
            break;
        }
      }
    });

    function insertSpaces(count) {
      const selection = window.getSelection();
      if (!selection.rangeCount) return;
      
      const range = selection.getRangeAt(0);
      range.deleteContents();
      range.insertNode(document.createTextNode(' '.repeat(count)));
      
      // Move cursor after the spaces
      range.setStart(range.endContainer, range.endOffset);
      range.collapse(true);
      selection.removeAllRanges();
      selection.addRange(range);
    }

    function handleBackspace() {
      const selection = window.getSelection();
      if (!selection.rangeCount) return false;
      
      const range = selection.getRangeAt(0);
      const node = range.startContainer;
      const offset = range.startOffset;
      
      // Check for tab removal (4 spaces)
      if (offset >= 4 && node.nodeType === Node.TEXT_NODE) {
        const textBefore = node.textContent.substring(offset - 4, offset);
        if (textBefore === '    ') {
          // Delete the 4 spaces
          const newRange = document.createRange();
          newRange.setStart(node, offset - 4);
          newRange.setEnd(node, offset);
          selection.removeAllRanges();
          selection.addRange(newRange);
          document.execCommand('delete');
          return true;
        }
      }
      
      return false;
    }

    function handleEnter() {
      const selection = window.getSelection();
      if (!selection.rangeCount) return false;
      
      const range = selection.getRangeAt(0);
      const node = range.startContainer;
      const offset = range.startOffset;
      
      // Get current line text
      const lineText = getCurrentLineText(node, offset);
      
      // Check if we're in a list line (starts with '- ')
      if (lineText.trim().startsWith('- ')) {
        // If the line only has the bullet, remove it on enter
        if (lineText.trim() === '- ') {
          // Delete the bullet
          const lineStartPos = getLineStartPosition(node, offset);
          const newRange = document.createRange();
          newRange.setStart(lineStartPos.node, lineStartPos.offset);
          newRange.setEnd(node, offset);
          selection.removeAllRanges();
          selection.addRange(newRange);
          document.execCommand('delete');
          document.execCommand('insertText', false, '\n');
          return true;
        }
        
        // Get the indentation
        const indentation = lineText.match(/^\s*/)[0];
        
        // Insert new list item with same indentation
        document.execCommand('insertText', false, '\n' + indentation + '- ');
        return true;
      }
      
      return false;
    }

    function getCurrentLineText(node, offset) {
      if (node.nodeType !== Node.TEXT_NODE) return '';
      
      const text = node.textContent;
      let lineStart = offset;
      while (lineStart > 0 && text[lineStart - 1] !== '\n') lineStart--;
      
      let lineEnd = offset;
      while (lineEnd < text.length && text[lineEnd] !== '\n') lineEnd++;
      
      return text.substring(lineStart, lineEnd);
    }
    
    function getLineStartPosition(node, offset) {
      if (node.nodeType !== Node.TEXT_NODE) return { node, offset: 0 };
      
      const text = node.textContent;
      let lineStart = offset;
      while (lineStart > 0 && text[lineStart - 1] !== '\n') lineStart--;
      
      return { node, offset: lineStart };
    }
    
    function handleCodeBlock() {
      const selection = window.getSelection();
      if (!selection.rangeCount) return;
      
      const range = selection.getRangeAt(0);
      const selectedText = range.toString();
      
      if (selectedText) {
        // If text is selected, wrap it in code tags
        document.execCommand('insertHTML', false, `<code>${selectedText}</code>`);
      } else {
        // If no text is selected, insert empty code tags and place cursor inside
        document.execCommand('insertHTML', false, '<code></code>');
        
        // Move cursor inside code tags
        const codes = document.getElementsByTagName('code');
        if (codes.length > 0) {
          const lastCode = codes[codes.length - 1];
          const newRange = document.createRange();
          newRange.setStart(lastCode, 0);
          newRange.collapse(true);
          selection.removeAllRanges();
          selection.addRange(newRange);
        }
      }
    }
    
    function handleList() {
      const selection = window.getSelection();
      if (!selection.rangeCount) return;
      
      // Insert a list item at the current position
      document.execCommand('insertText', false, '- ');
    }
    
    // Button event listeners
    document.getElementById('btn-bold').addEventListener('click', () => {
      document.execCommand('bold');
      editor.focus();
    });
    
    document.getElementById('btn-italic').addEventListener('click', () => {
      document.execCommand('italic');
      editor.focus();
    });
    
    document.getElementById('btn-code').addEventListener('click', () => {
      handleCodeBlock();
      editor.focus();
    });
    
    document.getElementById('btn-list').addEventListener('click', () => {
      handleList();
      editor.focus();
    });
    
    document.getElementById('btn-theme').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark-theme');
      document.body.classList.toggle('dark-theme');
      
      // Save theme preference - commented out for sandbox
      /*
      if (document.body.classList.contains('dark-theme')) {
        localStorage.setItem('theme', 'dark');
      } else {
        localStorage.setItem('theme', 'light');
      }
      */
      
      editor.focus();
    });
    
    document.getElementById('btn-export').addEventListener('click', () => {
      const text = editor.innerText;
      const blob = new Blob([text], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'notes.txt';
      a.click();
      editor.focus();
    });
    
    document.getElementById('btn-save').addEventListener('click', () => {
      // localStorage.setItem("saved-content", editor.innerHTML);
      showNotification("Content saved successfully");
      editor.focus();
    });
    
    // Highlight text
    document.getElementById('highlight-select').addEventListener('change', (e) => {
      const value = e.target.value;
      if (!value) return;
      
      const selection = window.getSelection();
      if (!selection.rangeCount) return;
      
      const range = selection.getRangeAt(0);
      
      if (value === 'remove') {
        // Remove all highlight classes
        document.execCommand('removeFormat');
      } else {
        // Save the selection
        const selectedText = range.toString();
        
        if (selectedText) {
          // Create a span with the highlight class
          const span = document.createElement('span');
          span.className = value;
          span.textContent = selectedText;
          
          // Replace the selection with the span
          range.deleteContents();
          range.insertNode(span);
        }
      }
      
      // Reset the select
      e.target.value = '';
      editor.focus();
    });
    
    // Notification function
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.position = 'fixed';
      notification.style.bottom = '60px';
      notification.style.right = '20px';
      notification.style.backgroundColor = document.body.classList.contains('dark-theme') ? '#333' : 'white';
      notification.style.color = document.body.classList.contains('dark-theme') ? '#e0e0e0' : 'black';
      notification.style.padding = '10px 15px';
      notification.style.borderRadius = '4px';
      notification.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
      notification.style.zIndex = '200';
      notification.style.transition = 'opacity 0.3s ease-out';
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Remove after 2 seconds
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 2000);
    }
  </script>
</body>
</html>
